Revision: 2be9b6c7c3ca7ac182fbd61dab64f5b91d16aa20
Patch-set: 2
File: compiler/optimizing/intrinsics_x86.cc

948:0-950:35
Sat May 09 07:15:32 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: ad921112_2c9e7b39
Bytes: 76
Shouldn't you update the comment, based on Mark's suggestion and add a TODO?

948:0-950:35
Sat May 09 07:53:41 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: ad921112_2c9e7b39
UUID: 4d6d15ec_707bed3b
Bytes: 710
No, this is implemented in the latest version.

I disagree with the complexity of RegisterOrConstant. Even if it's a constant, it *must* end up in ax as that is what repne scasw requires. So it's easiest to request that here.

Below I simply check the instruction's parameter (as an instruction itself), see line 984ff.

There's a tradeoff here. The slow-path(s) may have to re-order things if we do it like this. So there's maybe a bit of space overhead involved in the out-of-line path. On the other hand, it means we need one less register in the "good" case, as the character is already in the right register (and the input doesn't get clobbered). I felt the saved register is worth more, as this is x86...

948:0-950:35
Sat May 09 12:41:33 2015 +0000
Author: Mark P Mendell <1036869@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 4d6d15ec_707bed3b
UUID: 0d407d41_01248dda
Bytes: 79
I like Andreas's solution.  A bit ugly looking, but it generates the best code.

956:5-956:8
Mon May 11 11:48:54 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: ad24d1ad_a7aef65f
Bytes: 6
repne?

971:11-971:14
Mon May 11 11:48:54 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: ad24d1ad_27d1e6ff
Bytes: 8
counter?

972:11-972:15
Mon May 11 11:48:54 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: ad24d1ad_e7b2bed5
Bytes: 14
string_length?

985:81-985:88
Sat May 09 14:14:10 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: ed5b293d_6cb30a7c
Bytes: 27
Don't we have a kMaxUint16?

995:36-995:42
Sat May 09 14:14:10 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: ed5b293d_4cae0615
Bytes: 5
ditto

1007:10-1007:16
Sat May 09 14:14:10 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: ed5b293d_2cbd1244
Bytes: 58
-> Load length (that is, the 'count' field of the string).

1010:29-1010:49
Mon May 11 11:48:54 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cd290587_e8296f83
Bytes: 58
Maybe move TODO on its own line to make it easier to spot?

1048:38-1049:14
Mon May 11 11:48:54 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 2d62a1ee_e3650e91
Bytes: 51
Do you think we could factor these implementations?

1048:38-1049:14
Mon May 11 15:55:26 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 2d62a1ee_e3650e91
UUID: 2d70e1c2_3601f107
Bytes: 188
The usage of the temporaries is inverted up to the repne scasw - otherwise the register can't be saved.

If you feel strongly, I can unify and use one more temporary, just like Quick does.

1048:38-1049:14
Mon May 11 17:17:22 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 2d70e1c2_3601f107
UUID: ad24d1ad_c2845011
Bytes: 54
Oh right, I see.  Then it's probably better as-is.  :)

1055:54-1055:61
Mon May 11 11:48:54 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: cd290587_68821fda
Bytes: 19
VisitStringIndexOf?

1131:21-1131:37
Sat May 09 14:14:10 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: ad921112_2c775b8b
Bytes: 30
update ecx, used as a counter.

1131:44-1131:49
Sat May 09 14:14:10 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 4d5fd527_8a8d408a
Bytes: 8
going to

1131:44-1131:81
Sat May 09 14:14:10 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 4d5fd527_6a920ca8
Bytes: 64
When is it going to be that value? I find the comment confusing.

File: compiler/utils/x86/assembler_x86.h

467:7-467:17
Mon May 11 11:48:54 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: ad24d1ad_27756678
Bytes: 12
repne_scasw?

