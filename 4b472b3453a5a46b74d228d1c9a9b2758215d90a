Revision: 4b472b3453a5a46b74d228d1c9a9b2758215d90a
Patch-set: 7
File: /COMMIT_MSG

29:0-29:45
Fri Sep 02 17:34:08 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 76ee6f74_eaddfbff
Bytes: 42
Did you run the tests with graph-coloring?

29:0-29:45
Mon Sep 05 16:29:00 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 76ee6f74_eaddfbff
UUID: 36b797b7_873c46cf
Bytes: 368
With or without this CL, if we change the kRegisterAllocatorDefault to graph coloring, we get

FAILING TESTS
test-art-host-run-test-debug-prebuild-optimizing-relocate-ntrace-cms-checkjni-image-npictest-ndebuggable-484-checker-register-hints32
test-art-host-run-test-debug-prebuild-optimizing-relocate-ntrace-cms-checkjni-image-npictest-ndebuggable-570-checker-select32

File: compiler/optimizing/code_generator.cc

1232:2-1232:10
Fri Sep 02 17:34:08 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 76ee6f74_473d02ed
Bytes: 5
const

1232:2-1232:10
Mon Sep 05 11:19:39 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 76ee6f74_473d02ed
UUID: b6ff0722_bb2f47f8
Bytes: 4
Done

1244:2-1244:10
Fri Sep 02 17:34:08 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 76ee6f74_2742fe60
Bytes: 5
const

1244:2-1244:10
Mon Sep 05 11:19:39 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 76ee6f74_2742fe60
UUID: 36b797b7_27fa3a5e
Bytes: 4
Done

File: compiler/optimizing/code_generator_arm.cc

4000:4-4000:89
Fri Sep 02 17:34:08 2016 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 76ee6f74_670b662e
Bytes: 128
Maybe consider a very simple helper function to have some more expressive name here, e.g., maybe:

  SetNoCallerSaves(locations)

4000:4-4000:89
Sat Sep 03 00:26:58 2016 +0000
Author: Mingyao Yang <1043514@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 76ee6f74_670b662e
UUID: 3642374d_32afee36
Bytes: 258
Even if we don't do this, for correctness it will still be fine, right? Just want to make sure, since some of the cases below it seems to me we can have two slow paths, like HLoadString can have both a baker-read-barrier slow path and a null-check slow path.

4000:4-4000:89
Mon Sep 05 11:19:39 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 3642374d_32afee36
UUID: 91668dcf_ba53f1de
Bytes: 309
Overestimating the necessary spill size leads to suboptimal but working code. That's what we were generally doing before this CL.

For HLoadString/HLoadClass, we're also checking "!load->NeedsEnvironment()" so that we don't underestimate the necessary spill size; underestimating would lead to incorrect code.

4000:4-4000:89
Mon Sep 05 12:46:09 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 76ee6f74_670b662e
UUID: 36b797b7_675fd244
Bytes: 145
Not sure where to put that helper function. (LocationsBuilder<arch> derive directly from HGraphVisitor and that's certainly not the right place.)

File: compiler/optimizing/locations.h

652:7-652:36
Mon Sep 05 11:20:48 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 36b797b7_47496eb4
Bytes: 19
bool has_custom_...

652:7-652:36
Mon Sep 05 12:43:15 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 36b797b7_47496eb4
UUID: 36b797b7_47b5ee87
Bytes: 4
Done

667:0-668:45
Mon Sep 05 11:20:48 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 36b797b7_674ef2bf
Bytes: 215
Should we make this always valid, so that we don't need the flag?

Also, we could make it empty for non-calling instruction, which would make the code cleaner whenever it needs to know which registers to save. WDYT?

667:0-668:45
Mon Sep 05 12:43:15 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 36b797b7_674ef2bf
UUID: 36b797b7_e7a50253
Bytes: 66
It isn't that easy. I'd rather avoid the refactoring at this time.

File: compiler/optimizing/register_allocation_resolver.cc

47:0-65:3
Mon Sep 05 11:20:48 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 36b797b7_07437696
Bytes: 52
Maybe add a helper ComputeMaximumSafepointSpillSize.

47:0-65:3
Mon Sep 05 12:43:15 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 36b797b7_07437696
UUID: 36b797b7_a7862abf
Bytes: 4
Done

File: compiler/optimizing/register_allocator_graph_color.cc

19:0-20:23
Fri Sep 02 16:36:01 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 91668dcf_9a0f0d43
Bytes: 65
Leftovers from PS5. I'll wait for other comments before removing.

19:0-20:23
Mon Sep 05 11:19:39 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 91668dcf_9a0f0d43
UUID: 16fd3327_1e374d08
Bytes: 4
Done

