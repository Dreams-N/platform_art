Revision: fd9ed425e0aebc85b9327dee992467d472b4a05e
Patch-set: 4
File: runtime/entrypoints/quick/quick_trampoline_entrypoints.cc

722
Tue Oct 06 23:38:00 2015 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 30592d74_20dbced8
Bytes: 188
Ah, ok, this makes more sense now. This was pretty subtle earlier.

Perhaps, add something like ... " as an optimization defer allocating lock counter until we know for a fact we need it"?

722
Wed Oct 07 00:44:27 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 30592d74_20dbced8
UUID: 504861a0_61515245
Bytes: 4
Done

723
Tue Oct 06 23:38:00 2015 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 704d65ae_7f9d6ba9
Bytes: 270
This can go inline if you want, there's no requirement to put it above the call.

   function_call(
                 nullptr,   // No last shadow coming from quick
                 false,     // Disable lock counting 
                 ...)

Thanks for fixing it in PS#4.

723
Wed Oct 07 00:44:27 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 704d65ae_7f9d6ba9
UUID: 1001893d_942e4a2c
Bytes: 57
I usually don't like comments in macros at all, but done.

File: test/088-monitor-verification/src/Main.java

225
Tue Oct 06 23:40:40 2015 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 105c2963_dcf00154
Bytes: 112
This doesn't seem safe, shouldn't there be a TODO here to punt to interpreter if locks can't be proven balanced?

225
Tue Oct 06 23:42:22 2015 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 105c2963_dcf00154
UUID: 504861a0_21abcab2
Bytes: 328
Agh, I had a more detailed comment. GERRIT!
--------
I may be mis-understanding what's going on overall, so I apologize in advance.

Isn't it currently changing semantics if run inside of interpreter vs compiled code? If so, we should probably punt to interpreter if it can't be proven balanced, to avoid diverging of semantics?

225
Wed Oct 07 00:44:27 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 504861a0_21abcab2
UUID: 704d65ae_e221e2b4
Bytes: 263
Sorry, I'll extend the comment.

Some test cases are "positive" tests, that is, they assert that we were able to verify and then compile (see the smali code). But then if you start with interpreted code, anyways, this goes wrong - so I disable those asserts here.

