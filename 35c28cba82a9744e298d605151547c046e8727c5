Revision: 35c28cba82a9744e298d605151547c046e8727c5
Patch-set: 9
File: compiler/optimizing/builder.cc

778:74-779:64
Wed Nov 25 17:02:10 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: fbbdbfca_19ff0b5a
Bytes: 140
Rewording suggestion:

  If we cannot resolve the method's declaring class (which
  can only happen when compiling ahead of time), bail out.

778:74-779:64
Tue Dec 01 14:23:25 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: fbbdbfca_19ff0b5a
UUID: 7b0c6fc0_874a6636
Bytes: 4
Done

801:5-801:36
Wed Nov 25 17:02:10 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: fb921f65_ee219f7c
Bytes: 37
Check for incompatible class changes?

801:5-801:36
Tue Dec 01 14:23:25 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: fb921f65_ee219f7c
UUID: 5b032b91_0609da06
Bytes: 4
Done

802:32-802:63
Wed Nov 25 17:02:10 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: fb921f65_0e3c2ba3
Bytes: 6
Ditto.

802:32-802:63
Tue Dec 01 14:23:25 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: fb921f65_0e3c2ba3
UUID: 5b032b91_c61bc24e
Bytes: 4
Done

806
Wed Nov 25 17:02:10 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: fb921f65_ae279791
Bytes: 17
Extra blank line.

806
Tue Dec 01 14:23:25 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: fb921f65_ae279791
UUID: 5b032b91_e616be28
Bytes: 4
Done

File: runtime/entrypoints/entrypoint_utils-inl.h

601:0-606:89
Wed Nov 25 16:45:10 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 9baf638f_c1ae78a5
Bytes: 316
I don't understand how we get here for the new test, I would expect the code above to take the early return branch for resolved_method==nullptr, or does it point to the resolution trampoline? In that case, should we check for the trampoline instead, or is the trampoline actually going to the the right thing anyway?

601:0-606:89
Wed Nov 25 17:10:30 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 9baf638f_c1ae78a5
UUID: 9baf638f_01d23026
Bytes: 609
The resolved method is found, as the invoke-super is pointing to the subclass's method.

The verifier detects the problem but makes it a soft failure, which the optimizing compiler decides to not compile, but Quick does the compilation. Because there's a failure, Quick will use the invokeSuperTrampoline, and ends up there.

So when arriving here, the trampoline resolves the method the invoke-super points to, and finds it. It's only used to know the index in the vtable though, as the specification says so. But because there's no such method in the vtable, we would crash here with an array out of bounds.

File: test/551-invoke-super/smali/invokesuper.smali

22:0-22:7
Wed Nov 25 17:02:10 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 7bb2aff7_fa4085e5
Bytes: 62
Nit: use the same indentation as in lines 29–32 and 38–39.

22:0-22:7
Tue Dec 01 14:23:25 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 7bb2aff7_fa4085e5
UUID: fbf77fdf_a3f79a46
Bytes: 4
Done

File: test/551-invoke-super/smali/superclass.smali

21:0-21:7
Wed Nov 25 17:02:10 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: fbbdbfca_79fe3f5b
Bytes: 6
Ditto.

21:0-21:7
Tue Dec 01 14:23:25 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: fbbdbfca_79fe3f5b
UUID: 9b3e8348_a3c0e451
Bytes: 4
Done

File: test/552-invoke-non-existent-super/info.txt

1:76-1:77
Wed Nov 25 17:02:10 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bbb8a7d5_fceec51a
Bytes: 18
Nit: extra period.

1:76-1:77
Tue Dec 01 14:23:25 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bbb8a7d5_fceec51a
UUID: db347b68_4208f2aa
Bytes: 4
Done

File: test/552-invoke-non-existent-super/smali/invokesuper.smali

22:0-22:7
Wed Nov 25 17:02:10 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: fbbdbfca_b90ff744
Bytes: 6
Ditto.

22:0-22:7
Tue Dec 01 14:23:25 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: fbbdbfca_b90ff744
UUID: 5b032b91_a610c62b
Bytes: 4
Done

File: test/552-invoke-non-existent-super/smali/superclass.smali

21:0-21:7
Wed Nov 25 17:02:10 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: fbbdbfca_d90cb352
Bytes: 6
Ditto.

21:0-21:7
Tue Dec 01 14:23:25 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: fbbdbfca_d90cb352
UUID: 5b488bfd_1e81ed68
Bytes: 4
Done

