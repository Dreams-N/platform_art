Revision: 1ef9aecf7761024ec55a61595584c68c9c087877
Patch-set: 2
File: runtime/native/dalvik_system_DexFile.cc

63:25-63:27
Tue Feb 24 00:37:47 2015 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: a57141c9_19b74bd2
Bytes: 17
No statics please

63:25-63:27
Tue Feb 24 00:38:34 2015 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: a57141c9_19b74bd2
UUID: a57141c9_5994e329
Bytes: 15
I mean globals*

63:25-63:27
Tue Feb 24 00:48:15 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: a57141c9_5994e329
UUID: 4597a502_5ef29523
Bytes: 60
Then rewrite it. It's your stuff that breaks with globals...

63:25-63:27
Tue Feb 24 00:49:29 2015 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 4597a502_5ef29523
UUID: e59df926_1b797bdc
Bytes: 87
You mean runtime shutdown, but since this will only break for valgrind I suppose its OK

63:0-63:83
Tue Feb 24 08:26:28 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 85f19d52_20c0aa03
Bytes: 50
How about changing these vectors into Java arrays?

63:0-63:83
Tue Feb 24 16:32:53 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 85f19d52_20c0aa03
UUID: 2540f174_80e29820
Bytes: 204
That would be quite some overhead, and it would be ugly (must be array of longs), and only relevant for dalvikvm Valgrind run-tests. So I feel it's overkill. But if the team thinks that's the right way...

63:0-63:83
Tue Feb 24 16:34:02 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 2540f174_80e29820
UUID: 8520bddf_6834a304
Bytes: 59
Overhead on what? Don't we have a DexFile java abstraction?

63:0-63:83
Tue Feb 24 16:37:22 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 8520bddf_6834a304
UUID: c5cb9564_42c6f2a4
Bytes: 203
Overhead on size, overhead on JNI code.

Yes, we have the Java abstraction, but we need to store native references. So it's an array of native pointers. Copying into/out of etc. isn't pretty code in JNI.

63:0-63:83
Tue Feb 24 16:41:23 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: c5cb9564_42c6f2a4
UUID: e5f7b997_ab068946
Bytes: 131
Then better not live in Java then... Or.... wait :)

Looks like another option would be to put these dex files on our class loader.

63:0-63:83
Tue Feb 24 16:49:54 2015 +0000
Author: Brian Carlstrom <1003723@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: e5f7b997_ab068946
UUID: c52635f8_6ad2d7d5
Bytes: 71
you can use DexFile as a public API without one of our class loaders...

63:0-63:83
Tue Feb 24 16:57:49 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: c52635f8_6ad2d7d5
UUID: e5f7b997_4b7445b3
Bytes: 80
Sure, but that's at the Java level, which has (or can have) proper deallocation.

