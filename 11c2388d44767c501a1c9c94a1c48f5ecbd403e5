Revision: 11c2388d44767c501a1c9c94a1c48f5ecbd403e5
Patch-set: 5
File: compiler/dex/quick/mips/utility_mips.cc

59
Wed Feb 18 18:59:35 2015 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 6bd55878_6a7a5709
Bytes: 313
Is this right? The positive check is valid for values up to 2^16-1 but the negative check is only valid for values as small as -2^15. I fear when there is a positive value between 2^15 and 2^16-1 it might cause an overflow if the encoding is only for int16.

Perhaps it should be just

  return IsInt<16>(value) ?

59
Thu Feb 19 00:47:29 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 6bd55878_6a7a5709
UUID: 880a9212_38e58929
Bytes: 106
No, on Mips you can encode a 16b unsigned immediate and a 16b signed immediate. See LoadConstantNoClobber.

File: compiler/utils/arm/assembler_arm.cc

284
Wed Feb 18 18:59:35 2015 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 2bc7e0d6_888a3785
Bytes: 145
Overflows for 1021<->1023 and underflows for -1021<->-1024

I am basing this purely off the comment. Should this be a simple range check instead?

284
Thu Feb 19 00:47:29 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 2bc7e0d6_888a3785
UUID: 0b205c81_6a77d31d
Bytes: 10
Rewritten.

File: runtime/utils.h

132:2-134:46
Wed Feb 18 08:40:34 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 6b69d873_472c8eba
Bytes: 114
Nit: I would put this check standalone with the comment:

if (kBits == ...) {
  // Corner case...
  return true;
}

132:2-134:46
Wed Feb 18 18:50:22 2015 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 6b69d873_472c8eba
UUID: 6bd55878_6a16d7ef
Bytes: 55
It's illegal to have [if] statements in C++11 constexpr

144:2-146:24
Wed Feb 18 08:40:34 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 6b69d873_672992a9
Bytes: 5
ditto

144:2-146:24
Wed Feb 18 18:50:22 2015 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 6b69d873_672992a9
UUID: 2bc7e0d6_286b4355
Bytes: 9
See above

