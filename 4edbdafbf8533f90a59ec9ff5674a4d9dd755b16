Revision: 4edbdafbf8533f90a59ec9ff5674a4d9dd755b16
Patch-set: 10
File: compiler/oat_writer.h

145:5-145:81
Mon Sep 05 14:50:35 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: b6ff0722_5bba8378
Bytes: 7
Update?

145:5-145:81
Mon Sep 05 15:50:16 2016 +0000
Author: David Brazdil <1059815@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: b6ff0722_5bba8378
UUID: 318881a4_854de68d
Bytes: 4
Done

149:34-149:43
Mon Sep 05 14:50:35 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 318881a4_05b396a2
Bytes: 129
Isn't that a dex_file instead? If not, what is vdex in them? (same comments for methods below where you name the file vdex_file).

149:34-149:43
Mon Sep 05 15:50:16 2016 +0000
Author: David Brazdil <1059815@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 318881a4_05b396a2
UUID: 36b797b7_6782726c
Bytes: 415
Nope, this is the actual VDEX that this thing is writing into. DEX files are added with Add*DexFileSource methods. It's a little annoying because we write into VDEX through the OutputStream but need the file's FD for mmap. Might create the vdex_out stream inside the method. It's not actually needed outside.

For all of these methods I've tried to make it clear which output stream is into vdex and which into oat.

File: dex2oat/dex2oat.cc

707:58-707:77
Mon Sep 05 14:50:35 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 16453384_7ee1f18f
Bytes: 54
"with one oat filename, or with two file descriptors"?

707:58-707:77
Mon Sep 05 15:50:16 2016 +0000
Author: David Brazdil <1059815@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 16453384_7ee1f18f
UUID: 16fd3327_dee0c523
Bytes: 4
Done

1261:0-1261:35
Mon Sep 05 14:50:35 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 7182f983_e496b4f5
Bytes: 55
I know it's old code, but a comment would be nice here.

1261:0-1261:35
Tue Sep 06 13:20:04 2016 +0000
Author: David Brazdil <1059815@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 7182f983_e496b4f5
UUID: f6417f7a_2048e47f
Bytes: 112
I'm not the author, but I assume it's because we don't want to close the FDs created by installd. Comment added.

1891:0-1891:33
Mon Sep 05 14:50:35 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 36b797b7_e73f42c2
Bytes: 41
Could we avoid the silently passing null?

1891:0-1891:33
Mon Sep 05 15:50:16 2016 +0000
Author: David Brazdil <1059815@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 36b797b7_e73f42c2
UUID: b6ff0722_7b43ff67
Bytes: 146
I don't even know what this is for, to be honest. I don't see any situation when `oat_files_` would contain a null. But that's for a different CL.

1901:0-1901:33
Mon Sep 05 14:50:35 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 7182f983_049c7814
Bytes: 5
ditto

File: dex2oat/dex2oat_test.cc

56:0-56:51
Mon Sep 05 14:50:35 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: f6417f7a_5d44fbfb
Bytes: 7
Remove?

56:0-56:51
Mon Sep 05 15:50:16 2016 +0000
Author: David Brazdil <1059815@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: f6417f7a_5d44fbfb
UUID: 91668dcf_7d92334f
Bytes: 4
Done

File: oatdump/oatdump.cc

725:4-725:42
Mon Sep 05 14:50:35 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 7182f983_447e80b9
Bytes: 52
Update comment? At least say where/what is embedded.

725:4-725:42
Mon Sep 05 15:50:16 2016 +0000
Author: David Brazdil <1059815@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 7182f983_447e80b9
UUID: 16453384_5e423561
Bytes: 4
Done

File: patchoat/patchoat.cc

63:35-63:39
Mon Sep 05 14:50:35 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: b6ff0722_1bb4fb88
Bytes: 27
should be agnostic of vdex.

63:35-63:39
Mon Sep 05 15:50:16 2016 +0000
Author: David Brazdil <1059815@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: b6ff0722_1bb4fb88
UUID: 16453384_be56d923
Bytes: 4
Done

55:0-74:1
Mon Sep 05 14:50:35 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 16fd3327_7e8bf176
Bytes: 38
Seems like a general utility function?

55:0-74:1
Mon Sep 05 15:50:16 2016 +0000
Author: David Brazdil <1059815@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 16fd3327_7e8bf176
UUID: 91668dcf_bda20b9c
Bytes: 104
Indeed. Patchoat has more of those though, e.g. CreateAndOpen. Moved this helper next to the other ones.

330
Mon Sep 05 14:50:35 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 16fd3327_5e9035a3
Bytes: 116
Old code, but could you add a comment on what this section is, and why it is different than the loop just before it?

330
Mon Sep 05 16:06:02 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 16fd3327_5e9035a3
UUID: 16453384_7e329118
Bytes: 5
ping?

330
Tue Sep 06 13:20:04 2016 +0000
Author: David Brazdil <1059815@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 16453384_7e329118
UUID: 16fd3327_a1a9587c
Bytes: 27
Done. (hope i got it right)

375:0-375:70
Mon Sep 05 14:50:35 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 36b797b7_a7394ade
Bytes: 50
Comment please. Also, didn't we say we would copy?

375:0-375:70
Mon Sep 05 16:06:02 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 36b797b7_a7394ade
UUID: b6ff0722_1b42bb60
Bytes: 5
ping?

375:0-375:70
Tue Sep 06 13:20:04 2016 +0000
Author: David Brazdil <1059815@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: b6ff0722_1b42bb60
UUID: 16453384_5e5d15e8
Bytes: 163
Here we always know the filename, so might as well symlink. We only need to copy when patching OAT (without image) passed to patchoat with FDs (later PSs do that).

File: runtime/oat_file.cc

984:31-984:37
Mon Sep 05 14:50:35 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 7182f983_04b398a2
Bytes: 5
exist

984:31-984:37
Mon Sep 05 15:50:16 2016 +0000
Author: David Brazdil <1059815@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 7182f983_04b398a2
UUID: f6417f7a_9dfa03a2
Bytes: 4
Done

File: runtime/oat_file_assistant.cc

567:0-572:3
Mon Sep 05 14:50:35 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 91668dcf_da998580
Bytes: 50
Comment please. Why would there already be a vdex?

567:0-572:3
Mon Sep 05 15:50:16 2016 +0000
Author: David Brazdil <1059815@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 91668dcf_da998580
UUID: 36b797b7_c770fe9e
Bytes: 40
Sorry, getting ahead of myself. Removed.

604:0-604:54
Mon Sep 05 14:50:35 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: b6ff0722_dba57353
Bytes: 7
Remove?

604:0-604:54
Mon Sep 05 15:50:16 2016 +0000
Author: David Brazdil <1059815@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: b6ff0722_dba57353
UUID: 91668dcf_1db217ed
Bytes: 4
Done

609:27-609:30
Mon Sep 05 14:50:35 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: b11ab155_061bbc7e
Bytes: 19
oat and vdex files.

609:27-609:30
Mon Sep 05 15:50:16 2016 +0000
Author: David Brazdil <1059815@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: b11ab155_061bbc7e
UUID: 36b797b7_e76d02c2
Bytes: 4
Done

File: runtime/oat_file_assistant_test.cc

97:0-97:81
Mon Sep 05 14:50:35 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: b6ff0722_bba2a747
Bytes: 7
Remove?

97:0-97:81
Mon Sep 05 15:50:16 2016 +0000
Author: David Brazdil <1059815@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: b6ff0722_bba2a747
UUID: b6ff0722_9b748bc7
Bytes: 4
Done

227:0-227:78
Mon Sep 05 14:50:35 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: b11ab155_2618b87f
Bytes: 5
ditto

227:0-227:78
Mon Sep 05 15:50:16 2016 +0000
Author: David Brazdil <1059815@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: b11ab155_2618b87f
UUID: 91668dcf_3dafdb83
Bytes: 4
Done

442:0-442:49
Mon Sep 05 14:50:35 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: b11ab155_86540cf9
Bytes: 5
ditto

442:0-442:49
Mon Sep 05 15:50:16 2016 +0000
Author: David Brazdil <1059815@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: b11ab155_86540cf9
UUID: 318881a4_451afe89
Bytes: 4
Done

File: runtime/vdex_file.h

43:0-43:37
Mon Sep 05 14:50:35 2016 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 16453384_de9f65fc
Bytes: 69
Sorry, didn't realize the comment would be so dull :) You can remove.

43:0-43:37
Mon Sep 05 15:50:16 2016 +0000
Author: David Brazdil <1059815@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 16453384_de9f65fc
UUID: 318881a4_652702d1
Bytes: 89
Yeah, don't worry. There will be more fields with bigger comment potential in the future.

