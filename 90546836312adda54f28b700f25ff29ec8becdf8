Revision: 90546836312adda54f28b700f25ff29ec8becdf8
Patch-set: 3
File: runtime/class_linker.cc

1795:38-1795:45
Fri Mar 14 08:40:47 2014 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bc97855d_2226eec9
Bytes: 78
Should we put the trampoline as code? So you don't need to do this setup here?

1795:38-1795:45
Fri Mar 14 14:53:31 2014 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bc97855d_2226eec9
UUID: fcb49dfd_3cc73134
Bytes: 389
No. There are two cases: static and non-static native methods. In the case of static methods, we must set the resolution trampoline, which deals with initialization. That is the first branch above. In the case of non-static methods, we can already set the JNI trampoline, and that's the inner branch.

So it's easier to do the fixup, which needs to happen for both these cases, afterwards.

1799:10-1799:12
Fri Mar 14 08:40:47 2014 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bc97855d_4229f299
Bytes: 91
Nit: I'd put the || on the next line, or if it doesn't fit at the end of the previous line.

1799:10-1799:12
Fri Mar 14 14:53:31 2014 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bc97855d_4229f299
UUID: dcb1990e_3bc73734
Bytes: 4
Done

1804:34-1804:35
Fri Mar 14 08:40:47 2014 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 9c872129_e90a7539
Bytes: 29
Why hasn't dex2oat done that?

1804:34-1804:35
Fri Mar 14 14:53:31 2014 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 9c872129_e90a7539
UUID: 5cbf69de_57e1acb1
Bytes: 101
Native methods not in the core image aren't linked. Anything loaded from an app is linked at runtime.

1805:38-1805:43
Fri Mar 14 08:40:47 2014 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bc822517_ca0da354
Bytes: 48
You've just checked that in the DCHECK_EQ above.

1805:38-1805:43
Fri Mar 14 14:53:31 2014 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bc822517_ca0da354
UUID: dcb1990e_bbc90745
Bytes: 35
Thanks, missed that in refactoring.

File: runtime/entrypoints/quick/quick_trampoline_entrypoints.cc

1501:45-1501:48
Fri Mar 14 08:40:47 2014 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 9c872129_092b499a
Bytes: 32
I don't understand this comment.

1501:45-1501:48
Fri Mar 14 14:53:31 2014 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 9c872129_092b499a
UUID: 5cbf69de_f7fa005b
Bytes: 369
Changed. This is meant to say that GetNativeMethod() either returns (1) a trampoline to the code to actually find/bind the native method (the trampoline is GetJniDlsymLookupStub, the actual implementation is artFindNativeMethod()), or (2) the code that was bound earlier. In case of (2) we're good. For (1) we actually need to execute that first before we can continue.

