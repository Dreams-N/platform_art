Revision: e6a5e2a8f4fbe9b01079bc6f8827c7ee12328d8b
Patch-set: 2
File: compiler/optimizing/code_generator.cc

39:0-41:6
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: c459e9e9_eeaa338b
Bytes: 39
Nit: Move this between lines 33 and 35.

File: compiler/optimizing/code_generator_mips.cc

19:0-32:46
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 24656596_f1ba1a59
Bytes: 35
Please sort this list of #includes.

117:60-117:63
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: c473a992_55a46cba
Bytes: 3
FPU

117:73-117:74
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 44e3394a_8a7cefd8
Bytes: 22
Add a space after `.`.

511:4-511:41
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 446ed97b_2fee0d2a
Bytes: 38
DCHECK_GE(new_position, old_position);

618:57-618:62
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: c473a992_d5887c30
Bytes: 23
/* double_slot */ false

620:57-620:61
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e48fcdab_be0cb9cb
Bytes: 22
/* double_slot */ true

628:0-629:37
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e45eedce_2cdb77e5
Bytes: 50
Introduce an art::mips::MipsAssembler::Pop method.

634:0-635:30
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e45eedce_cce8a376
Bytes: 51
Introduce an art::mips::MipsAssembler::Push method.

645:23-645:52
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e48fcdab_fec481db
Bytes: 21
(double_slot ? 1 : 0)

766:10-766:14
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 845371c9_495b457f
Bytes: 19
Indentation is off.

864:0-865:95
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e45eedce_8ce2ab92
Bytes: 38
Shouldn't we emit parallel moves here?

871:6-871:30
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e48fcdab_3e198905
Bytes: 123
Shouldn't we use

  __ Mfc1(dst_high, static_cast<FRegister>(src + 1));

when isa_features_.Is32BitFloatingPoint() is true?

884:6-884:30
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e48fcdab_5e265544
Bytes: 123
Shouldn't we use

  __ Mtc1(src_high, static_cast<FRegister>(dst + 1));

when isa_features_.Is32BitFloatingPoint() is true?

900:0-903:53
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 24656596_313c3246
Bytes: 38
Shouldn't we emit parallel moves here?

1022:61-1022:66
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 44e3394a_35f388dc
Bytes: 22
value ATTRIBUTE_UNUSED

1023:2-1023:24
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 64e03d3d_4b35cddd
Bytes: 7
Remove.

1135:2-1135:20
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 845371c9_4cc4b388
Bytes: 14
UNREACHABLE();

1177:25-1177:27
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 44e3394a_d52a1cb4
Bytes: 36
Please use a named constant instead.

1183:25-1183:27
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: c459e9e9_ee2553b4
Bytes: 9
Likewise.

1261
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: c459e9e9_8e1a9f73
Bytes: 76
DCHECK(instruction->IsAnd() || instruction->IsOr() || instruction->IsXor());

1268
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: c473a992_f5065829
Bytes: 53
DCHECK(instruction->IsAdd() || instruction->IsSub());

1372:8-1372:40
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: c459e9e9_ae1f5b62
Bytes: 64
Replace with

  else {
    DCHECK(instruction->IsSub());

and…

1378:8-1380:7
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 24656596_51ce86d9
Bytes: 15
…remove this.

1431
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e48fcdab_fee8012b
Bytes: 117
Shouldn't we use the result of `rhs_reg & kMaxIntShiftValue` as second operand (instead of using `rhs_reg` directly)?

1450:0-1451:40
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 845371c9_0ccebba6
Bytes: 62
Use

  Move64(locations->Out(), locations->IntAt(0);

instead?

1452:35-1452:37
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 44e3394a_b558385e
Bytes: 131
Introduce 

  static constexpr size_t kMipsBitsPerWord = kMipsWordSize * kBitsPerByte;

and use it instead of `32`, here and below.

1483
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 24656596_f1077a8e
Bytes: 118
Shouldn't we use the result of `rhs_reg & kMaxLongShiftValue` as second operand (instead of using `rhs_reg` directly)?

1491:32-1491:36
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 845371c9_8cd2ab44
Bytes: 16
kMipsBitsPerWord

1794
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e48fcdab_5ed81598
Bytes: 96
Add

  CheckEntrypointTypes<kQuickAputObject, void, mirror::Array*, int32_t, mirror::Object*>();

1988:38-1988:66
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 446ed97b_2fa04ded
Bytes: 41
Nit: align comment with the previous one.

2019
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 44e3394a_f562c009
Bytes: 424
if (in_type == Primitive::kPrimFloat) {
  if (instruction->IsGtBias()) {
    CheckEntrypointTypes<kQuickCmpgFloat, int32_t, float, float>();
  } else {
    CheckEntrypointTypes<kQuickCmplFloat, int32_t, float, float>();
  }
} else {
  if (instruction->IsGtBias()) {
    CheckEntrypointTypes<kQuickCmpgDouble, int32_t, double, double>();
  } else {
    CheckEntrypointTypes<kQuickCmplDouble, int32_t, double, double>();
  }
}

2124:0-2127:3
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 44e3394a_756fd0ed
Bytes: 130
LocationSummary::CallKind call_kind = (type == Primitive::kPrimLong)
    ? LocationSummary::kCall;
    : LocationSummary::kNoCall;

2182
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e48fcdab_7ed5d15e
Bytes: 69
Add

  CheckEntrypointTypes<kQuickLdiv, int64_t, int64_t, int64_t>();

2225
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 24656596_51c0c694
Bytes: 139
Add

  else {
      // A division by a non-null constant is valid. We don't need to perform
      // any check, so simply fall through.
  }

2236
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 24656596_71bdca1b
Bytes: 9
Likewise.

2448:55-2448:91
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 24656596_11ca4eb3
Bytes: 6
Ditto.

2448:17-2448:51
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e45eedce_6c2c0f4b
Bytes: 16
Add parentheses.

2523
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 64e03d3d_abf73981
Bytes: 79
Add

  CheckEntrypointTypes<kQuickA64Load, int64_t, volatile const int64_t*>();

2528:6-2529:60
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e45eedce_0c29db39
Bytes: 209
Shouldn't we use

  __ Mtc1(locations->GetTemp(2).AsRegister<Register>(),
          static_cast<FRegister>(locations->Out().AsFpuRegister<FRegister>() + 1));

when isa_features_.Is32BitFloatingPoint() is true?

2561:17-2561:51
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: c459e9e9_8ed37f01
Bytes: 16
Add parentheses.

2561:55-2561:91
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e45eedce_2c26176b
Bytes: 6
Ditto.

2636:6-2637:62
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 24656596_918e3e89
Bytes: 211
Shouldn't we use

  __ Mfh1(locations->GetTemp(2).AsRegister<Register>(),
          static_cast<FRegister>(locations->InAt(1).AsFpuRegister<FRegister>() + 1));

when isa_features_.Is32BitFloatingPoint() is true?

2643
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e45eedce_4c783336
Bytes: 81
Add

  CheckEntrypointTypes<kQuickA64Store, void, volatile int64_t *, int64_t>();

2892:74-2892:85
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 24656596_b19342b0
Bytes: 15
kCallArtMethod?

2895:75-2895:86
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e478ad71_3696181f
Bytes: 6
Ditto?

3042:0-3043:73
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 845371c9_6cf3afdb
Bytes: 26
Nit: put on a single line.

3044:0-3045:74
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 64e03d3d_8be195bd
Bytes: 9
Likewise.

3090:2-3090:95
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 845371c9_0c00fb39
Bytes: 176
if (instruction->IsEnter()) {
  CheckEntrypointTypes<kQuickLockObject, void, mirror::Object*>();
} else {
  CheckEntrypointTypes<kQuickUnlockObject, void, mirror::Object*>();
}

3491
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 845371c9_2cfdb7a2
Bytes: 62
CheckEntrypointTypes<kQuickLmod, int64_t, int64_t, int64_t>();

3500
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e48fcdab_3ef429f9
Bytes: 169
if (type == Primitive::kPrimFloat) {
  CheckEntrypointTypes<kQuickFmodf, float, float, float>();
} else {
  CheckEntrypointTypes<kQuickFmod, double, double, double>();
}

3679:6-3679:41
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e478ad71_76909020
Bytes: 44
DCHECK_EQ(input_type, Primitive::kPrimLong);

3756
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: c473a992_b5cea059
Bytes: 161
if (result_type == Primitive::kPrimFloat) {
  CheckEntrypointTypes<kQuickL2f, float, int64_t>();
} else {
  CheckEntrypointTypes<kQuickL2d, double, int64_t>();
}

3777
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 24656596_11a32efd
Bytes: 397
if (result_type != Primitive::kPrimLong) {
  if (input_type == Primitive::kPrimFloat) {
    CheckEntrypointTypes<kQuickF2iz, int32_t, float>();
  } else {
    CheckEntrypointTypes<kQuickD2iz, int32_t, double>();
  }
} else {
  if (input_type == Primitive::kPrimFloat) {
    CheckEntrypointTypes<kQuickF2l, int64_t, float>();
  } else {
    CheckEntrypointTypes<kQuickD2l, int64_t, double>();
  }
}

3878
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e45eedce_cc4c231e
Bytes: 34
#undef __
#undef QUICK_ENTRY_POINT

File: compiler/optimizing/code_generator_mips.h

119:7-119:15
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 24656596_115b2ece
Bytes: 24
Make this method static?

291:2-291:50
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: c459e9e9_2ea12baa
Bytes: 121
I think we got rid of this method in all other code generators  (see https://android-review.googlesource.com/#/c/154017).

File: compiler/optimizing/nodes.h

3881:21-3881:32
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e478ad71_b6722889
Bytes: 25
x86, ARM, MIPS and MIPS64

4085:21-4085:25
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 44e3394a_35970854
Bytes: 26
MIPS (and likewise below).

File: compiler/optimizing/register_allocator.cc

81:9-87:36
Thu Aug 27 17:31:26 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: c459e9e9_2ec5ab31
Bytes: 54
While you're at it, could you sort this list?  Thanks.

