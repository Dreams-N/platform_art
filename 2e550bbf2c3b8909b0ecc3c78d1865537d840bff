Revision: 2e550bbf2c3b8909b0ecc3c78d1865537d840bff
Patch-set: 2
File: compiler/optimizing/code_generator_arm64.cc

971
Tue Jan 13 14:32:35 2015 +0000
Author: Serban Constantinescu <1030338@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 4ec7bdd5_a5ae3e27
Bytes: 312
Load() should be similar and call MaybeRecordImplicitNullCheck(instruction, dex_pc) before returning.

Currently we use Load() for:

VisitArrayGet()
VisitInstanceFieldGet()
VisitStaticFieldGet()

I think all of them should have a MaybeRecordImplicitNullCheck() that can be neatly hidden in Load(), LoadAcquire().

972
Tue Jan 13 14:45:50 2015 +0000
Author: Calin Juravle <1022077@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 4ec7bdd5_c5941ad1
Bytes: 350
so ArrayGet shouldn't need anything. The check happens in ArrayLength which will always precede the Get/Set. Or can you think about a case where that's not true?

So I preferred to record the implicit null check after we call Load().

You are right though that I forgot to add the record for the static fields! Thanks! I will also add tests for that.

972
Tue Jan 13 15:05:59 2015 +0000
Author: Calin Juravle <1022077@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 4ec7bdd5_c5941ad1
UUID: ce800d7c_41b4b250
Bytes: 230
I was hasty and didn't think the last part of the comment through. For static access we don't need to record the implicit null check as we can't throw.

I will add some extra checks to not record the pc if we are on a static path.

972
Tue Jan 13 15:58:32 2015 +0000
Author: Serban Constantinescu <1030338@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 4ec7bdd5_c5941ad1
UUID: 0ec145c3_c319b621
Bytes: 361
I see...

Could there be a case where BoundCheckElimination removes the HBoundsCheck() associated with an array access and DeadCodeElimination removes the HArrayLength()  since it has no uses?

I assume that by this point we would have already caught a NULL object.

Currently this could not happen since we run the passes in the reverse order:

1 - DCE
2 - BCE

972
Tue Jan 13 15:59:56 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: ce800d7c_41b4b250
UUID: 2e99a9f9_a2a57abd
Bytes: 147
I don't know what exactly mingyao's BCE is doing, but I would assume that removing HBoundsCheck would as a follow-up allow removal of HArrayLength.

1055
Tue Jan 13 14:32:35 2015 +0000
Author: Serban Constantinescu <1030338@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 0ec145c3_837b3e5e
Bytes: 139
Why not after the switch:

switch {

}

MaybeRecordImplicitNullCheck(instruction, dex_pc);

Anyway for kPrimVoid we will die in LOG(FATAL).

1055
Tue Jan 13 14:45:50 2015 +0000
Author: Calin Juravle <1022077@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 0ec145c3_837b3e5e
UUID: ce800d7c_01170ab4
Bytes: 117
We want to record the pc right after the instruction that throws so we can find the corresponding dex_pc in the maps.

1055
Tue Jan 13 15:58:32 2015 +0000
Author: Serban Constantinescu <1030338@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: ce800d7c_01170ab4
UUID: ce800d7c_01762af3
Bytes: 19
Yes, you are right.

