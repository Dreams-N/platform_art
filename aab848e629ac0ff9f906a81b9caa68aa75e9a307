Revision: aab848e629ac0ff9f906a81b9caa68aa75e9a307
Patch-set: 1
File: Android.mk

0
Wed Dec 09 15:32:09 2015 +0000
Author: Sebastien Hertz <1029223@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 4520aa91_d5ac1cb1
Bytes: 270
When I look at this file before the second one, I was wondering why you needed to change the dep order here.

Now that I looked at the other file, I understand why but I find this error-prone. If someone reorders differently without seeing the '|', it will break things.

File: test/Android.run-test.mk

46
Wed Dec 09 14:37:11 2015 +0000
Author: Yohann Roussel <1023201@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 60cbdce2_2666d630
Bytes: 308
I'm not so sure of this one. I'm hesitant between:
- That, which is tricky
- Adding for each target
  ifeq ($(ANDROID_COMPILE_WITH_JACK),true)
    <target>: | setup-jack-server
  endif
- Defining
  TEST_ART_RUN_TEST_DEPENDENCIES := setup-jack-server
  and add "| $(TEST_ART_RUN_TEST_DEPENDENCIES)" to targets

46
Wed Dec 09 15:32:09 2015 +0000
Author: Sebastien Hertz <1029223@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 60cbdce2_2666d630
UUID: 4022588b_05b1f205
Bytes: 148
I find it weird to add an order-only dep in a variable.

Can we instead call a function that will setup the jack-server (only when Jack is enabled)?

46
Wed Dec 09 15:57:46 2015 +0000
Author: Yohann Roussel <1023201@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 4022588b_05b1f205
UUID: 251f3657_d4d53c0f
Bytes: 485
I could do something like

  define art-tests-order-dependency 
    $(if $(ANDROID_COMPILE_WITH_JACK),$(if $(filter-out true,,$(ANDROID_COMPILE_WITH_JACK)),,setup-jack-server),)
  endef

and then add "| $(art-tests-order-dependency)"
I'm not so fan of this.

The more of think of it the more I dislike current solution. If none of you express a preference I think I'm going to the second solution ie:
  ifeq ($(ANDROID_COMPILE_WITH_JACK),true)
    <target>: | setup-jack-server
  endif

46
Wed Dec 09 16:24:38 2015 +0000
Author: Sebastien Hertz <1029223@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 251f3657_d4d53c0f
UUID: a5f24653_603d920c
Bytes: 162
I'm not a build expert but I think I also prefer the 2nd solution. At least, you are sure to append you order-only dependency at the end of the dependencies list.

46
Wed Dec 09 18:55:00 2015 +0000
Author: Ying Wang <1003981@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: a5f24653_603d920c
UUID: 05487277_63c0027d
Bytes: 288
You can define a new variable:
TEST_ART_RUN_TEST_ORDERONLY_DEPENDENCIES :=
ifeq ($(ANDROID_COMPILE_WITH_JACK),true)
TEST_ART_RUN_TEST_ORDERONLY_DEPENDENCIES := \
  setup-jack-server
endif

then add "| $(TEST_ART_RUN_TEST_ORDERONLY_DEPENDENCIES)" to the end of each dependency declaration.

