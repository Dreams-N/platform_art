Revision: 296a9e6191452a339c0b3dfefadfc8f6fc20390c
Patch-set: 3
File: runtime/verifier/method_verifier.cc

3380
Mon Jun 08 20:53:01 2015 +0000
Author: Igor Murashkin <1021471@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 796b8031_42d277fc
Bytes: 135
Maybe make it a bit more explicit in the comments that it's for the non-range invokes only (even though it should be obvious from 3384)

3380
Mon Jun 08 23:37:17 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 796b8031_42d277fc
UUID: b9d41838_4fdb6494
Bytes: 4
Done

File: test/800-smali/smali/b_17410612.smali

11:23-11:25
Mon Jun 08 08:02:48 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: b9cfb89d_5593ec2b
Bytes: 159
This could fail because v2 is not initialized (not sure if we require dex registers to be initialized before use though...). Maybe safe to initialize it still?

11:23-11:25
Mon Jun 08 15:25:36 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: b9cfb89d_5593ec2b
UUID: 796b8031_52ab2a91
Bytes: 68
v2 is initialized. It's "this." The code was carefully chosen... :-)

11:23-11:25
Mon Jun 08 15:30:07 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 796b8031_52ab2a91
UUID: 99ce74a2_f73b1a8c
Bytes: 137
Ah! But then the long is formed of int and reference, which is clearly bogus :-) whereas int + int could be fine with the interpreter....

11:23-11:25
Mon Jun 08 15:35:34 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 99ce74a2_f73b1a8c
UUID: 399bc88e_f019ee38
Bytes: 603
Yes, there's a middle ground, though it isn't super feasible because we do have the assumption everywhere except the interpreter...

This code would have passed the verifier (and the compilers in non-debug) before (it's exactly the fuzzed code). So I just extracted that.

About half a year ago we discussed the pair thing in different settings (where fuzzing exposed int+int != long), and everyone agreed that pairs are expected. So while you're right that the spec isn't telling you about it, and the interpreter just works, this seemed the right way to go.

Let's see how many apps this will break...

