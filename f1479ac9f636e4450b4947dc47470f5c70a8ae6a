Revision: f1479ac9f636e4450b4947dc47470f5c70a8ae6a
Patch-set: 8
File: runtime/gc/space/image_space.cc

322:2-322:20
Thu Sep 24 03:41:35 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e9b08755_3120d062
Bytes: 71
This isn't C anymore, a cleanup should move the declaration to the use.

323:2-324:70
Thu Sep 24 03:41:35 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e9b08755_51275478
Bytes: 67
Same here, move below the early bailouts and separate them clearly.

384:6-419:12
Thu Sep 24 03:41:35 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 2e2e2591_8e955b2d
Bytes: 70
Factor into a helper function, so that the switch is clean and simple.

425:0-457:3
Thu Sep 24 03:41:35 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: ee86cdd4_01d82a8c
Bytes: 159
Factor into a helper, call from the second switch case and tail-call in the factored out helper of the third case. Simplifies the reading of the main decision.

File: runtime/image_assistant.cc

130:0-138:1
Thu Sep 24 03:41:35 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 4916f301_1446541a
Bytes: 69
DCHECKs for validity? These strings may be empty in case of failures.

249:0-263:1
Thu Sep 24 03:41:35 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: a905afc4_f783e08b
Bytes: 1008
With FindImageFilename taking location and isa explicitly, this can be refactored into

  static ImageInfo GetSpecialImageInfo(location, isa, type) {
    std::string cache_filename, system_filename;
    bool has_system = false;
    bool has_cache = false;
    bool dalvik_cache_exists = false;
    bool is_global_cache = false;
    FindImageFilename(location,
                      isa,
                      &system_filename,
                      &has_system,
                      &cache_filename,
                      &dalvik_cache_exists,
                      &has_cache,
                      &is_global_cache);
    return ImageInfo(type ? system_filename : cache_filename,
                     type);
  }
  
  ImageInfo ImageAssistant::GetCacheImageInfo() const {
    return GetSpecialImageInfo(location_, isa_, false);
  }

  ImageInfo ImageAssistant::GetSystemImageInfo() const {
    return GetSpecialImageInfo(location_, isa_, true);
  }

and you wouldn't need to store both names in ImageInfo...

File: runtime/image_assistant.h

73:2-74:39
Thu Sep 24 03:41:35 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 4916f301_b454c0c9
Bytes: 60
These should be separated with at least a one-liner comment.

94:2-99:54
Thu Sep 24 03:41:35 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 691737fc_9559c401
Bytes: 121
By passing in location and isa as in parameters you can move the declaration into the cc file, hiding the whole function.

109:2-113:51
Thu Sep 24 03:41:35 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: e9b08755_f1bda89e
Bytes: 31
Seems redundant to have both...

155:2-160:3
Thu Sep 24 03:41:35 2015 +0000
Author: Andreas Gampe <1041833@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 4916f301_3477105f
Bytes: 151
Are we really only storing both strings because you want this private "mutator"? You can hide all of this in the .cc file by refactoring differently...

