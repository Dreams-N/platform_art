Revision: 073866207ad1661ede110f105e4b1ea9bcedaec8
Patch-set: 1
File: runtime/utils.h

492:42-492:66
Fri Feb 13 21:37:01 2015 +0000
Author: Brian Carlstrom <1003723@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 6bb9d8a9_c7c6be1e
Bytes: 98
"for a DexFile or OatFile location"? and then discuss the new subtle leading / stripping behavior?

492:42-492:66
Tue Feb 17 18:42:00 2015 +0000
Author: Richard Uhler <1057373@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 6bb9d8a9_c7c6be1e
UUID: 0bb5bcf7_df6b9fd5
Bytes: 1003
I don't understand this comment.

My understanding of what the function does is this: given a dex location and the path of a dalvik cache directory, return the path to what the oat file should be named. This is done by turning the dex location into a file name (replacing '/' with '@' to get a valid filename), and adding '@classes.dex'. Does it do something different for the boot image?

After thinking some more, there is an ambiguity about what should happen if the dex location isn't absolute. Two sensible options are:
 1. Turn a relative dex location into an absolute dex location and form the oat file name from that.
 2. Treat a relative dex location as a separate dex location from the dex location corresponding to the absolute path of the relative dex location.

I had only thought of (2), not (1) when I posted this change. It seems a shame to add the work and complexity of (1) given that nobody uses relative dex locations. I'll have to think more about what I want to do here.

Thoughts?

492:42-492:66
Wed Feb 18 08:38:25 2015 +0000
Author: Brian Carlstrom <1003723@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 0bb5bcf7_df6b9fd5
UUID: 8b644c9b_0e7b0f55
Bytes: 698
the first half of the comment is just a nit about adding "location" to make it clear it is not a file path.

probably cache_location should be renamed to cache_directory to conversely make it clear it is expected to be a real path.

the second part about stripping leading / characters is because that seems to be part of the functional change to behavior in utils.cc

as far as relative dex locations, they used to work with dalvik. in fact i think there was some grossness that the art/tools/art script needs fully qualified instead of relative paths (and the old dalvik script did not). it is something we have lived without for a while, but it would make life easier to not have the limitation.

492:42-492:66
Wed Feb 18 16:37:08 2015 +0000
Author: Richard Uhler <1057373@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 8b644c9b_0e7b0f55
UUID: 0babfcf0_4c3dffb4
Bytes: 215
How did relative dex locations work in dalvik?
Was "/foo/bar/sludge.jar" considered the same as "../bar/sludge.jar" when the current working directory was "/foo/cat/"? Or were they considered distinct dex locations?

File: runtime/utils_test.cc

355:0-355:43
Fri Feb 13 21:37:01 2015 +0000
Author: Brian Carlstrom <1003723@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: abbf508b_0f22a948
Bytes: 45
need cases for without leading / now as well.

