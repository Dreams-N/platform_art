Revision: 80221968dcaaebe26e26bd89ed5bd021f2d25f60
Patch-set: 4
File: compiler/compiled_method.h

137:17-137:21
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_bd1e2b8d
Bytes: 74
"Find" is confusing, it completely hides the intent. Maybe "FindInterval"?

File: compiler/dex/quick/arm/call_arm.cc

431:21-431:24
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 266e407b_ac2e8bba
Bytes: 29
Nit: "!= 0u" for consistency.

595:35-595:36
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 63002af0_3ea0c56f
Bytes: 20
Shouldn't this be 4?

File: compiler/dex/quick/arm64/int_arm64.cc

1534
Fri Mar 20 17:25:22 2015 +0000
Author: Stuart Monteith <1037216@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 266e407b_cccadf1f
Bytes: 85
Use "kArm64PointerSize" from instruction_set.h
That is already (indirectly) included.

File: compiler/dex/quick/lazy_debug_frame_opcode_writer.cc

2:17-2:21
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_dd6e7ff9
Bytes: 4
2015

39:0-41:7
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_7df3f371
Bytes: 165
Bulk copy:

  opcodes_.insert(opcodes_.end(),
                  old_opcodes.begin() + pos,
                  old_opcodes.begin() + advance.pos);
  pos = advance.pos;

50:0-52:5
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 23147232_7c6e5580
Bytes: 10
Bulk copy.

File: compiler/dex/quick/lazy_debug_frame_opcode_writer.h

2:17-2:21
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_1d6d17ff
Bytes: 4
2015

30
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_bd7bcbb9
Bytes: 14
Line too long.

File: compiler/dex/quick/x86/int_x86.cc

956:9-956:40
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_bd150bf5
Bytes: 47
CFA adjustment should be outside the if, right?

971:8-971:40
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 63002af0_de08c1da
Bytes: 5
ditto

1167:8-1167:39
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_9d124709
Bytes: 5
ditto

1177:8-1177:39
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_7d41b3f9
Bytes: 5
ditto

1211:8-1211:40
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 23147232_3c51fdba
Bytes: 5
ditto

1220:8-1220:40
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 23147232_1c5639b3
Bytes: 5
ditto

File: compiler/dex/quick/x86/target_x86.cc

766:35-766:101
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 23147232_dc67a195
Bytes: 70
Can you move this to a local variable just like you did above, please?

1320:6-1320:30
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 23147232_bc64ed91
Bytes: 15
Outside the if?

1421:6-1421:31
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 23147232_9c612982
Bytes: 5
ditto

File: compiler/dwarf/debug_frame_opcode_writer.h

2:17-2:21
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 63002af0_3eb685f0
Bytes: 4
2015

79:20-79:28
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 23147232_3c2b3dae
Bytes: 60
reg_mask != 0u (we try to avoid implicit conversion to bool)

80:10-80:22
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_dd579f2b
Bytes: 20
(reg_mask & 1) != 0u

89:20-89:28
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 63002af0_1e462981
Bytes: 14
reg_mask != 0u

90:10-90:22
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_bd54eb27
Bytes: 20
(reg_mask & 1) != 0u

File: compiler/dwarf/debug_frame_writer.h

2:17-2:21
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_1d94f740
Bytes: 4
2015

45:37-45:77
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 23147232_3c41fd68
Bytes: 111
Are these constants defined? If so, you should use this expression directly instead of the pre-calculated 0x04.

File: compiler/dwarf/debug_line_opcode_writer.h

2:17-2:21
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_9d0c873c
Bytes: 4
2015

File: compiler/dwarf/debug_line_writer.h

46:7-46:41
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 23147232_9c7fe98d
Bytes: 29
What's the clang's rationale?

55
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 63002af0_fe2edd89
Bytes: 14
Line too long.

56:17-56:18
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 63002af0_9e2599a6
Bytes: 80
Why are we skipping the first one? (It prevents us from using range-based loop.)

59:9-59:13
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 63002af0_5ec5d13c
Bytes: 68
const auto& (or const std::string&, it's not that long to spell out)

63:9-63:13
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 63002af0_deb0c1d1
Bytes: 33
const auto& (or const FileEntry&)

File: compiler/dwarf/register.h

2:17-2:21
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_bdd62bee
Bytes: 4
2015

26:8-26:13
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 23147232_5c203199
Bytes: 153
const (or constexpr and make the constructor and the static functions constexpr as well; the only problem is with X86_64Core - until we upgrade to C++14)

File: compiler/dwarf/writer.h

2:17-2:21
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_9dd367fe
Bytes: 4
2015

141:0-143:5
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 63002af0_3ee325cf
Bytes: 162
Don't insert each byte on its own:

  size_t extra = data_->size() & (alignment - 1);
  if (extra != 0) {
    data->insert(data->end(), alignment - extra, 0);
  }

File: compiler/elf_writer_quick.cc

183
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 23147232_9cb6c969
Bytes: 12
&& reg !=  7

445:19-445:20
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_1d7d1731
Bytes: 6
4 or 8

459:26-459:31
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_bd8bcbb3
Bytes: 25
static_cast<uint32_t>(-1)

471
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 23147232_dc1201dc
Bytes: 259
else nothing? Does the

  if (dbg_line != nullptr) {
    // DW_AT_stmt_list DW_FORM_sec_offset.
    PushByte(dbg_abbrev, dwarf::DW_AT_stmt_list);
    PushByte(dbg_abbrev, dwarf::DW_FORM_sec_offset);
  }

tell the debugger if the line number offset is present?

543:31-543:45
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 63002af0_81e3fe1e
Bytes: 40
std::string::npos? It's a static member.

547:33-547:62
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 63002af0_61bfd2f4
Bytes: 102
In ART we try to avoid the subscript operator on map/unordered_map. Use find() and compare with end().

549:12-549:59
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 23147232_fff6d7dc
Bytes: 47
Use insert()/emplace() to insert the new entry.

553
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_20c9cea6
Bytes: 87
else nothing? Are we not going to record the directory from the file name (if present)?

556:26-556:46
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_9d47e7a8
Bytes: 42
Avoid subscript operator on unordered_map.

558:10-558:43
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_80bada02
Bytes: 18
insert()/emplace()

640:8-640:20
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 23147232_5f36e319
Bytes: 12
thumb_offset

File: compiler/optimizing/code_generator_arm.cc

541:0-543:35
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 23147232_dcb6813c
Bytes: 19
IncreaseFrameSize()

552:0-554:36
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 63002af0_1edf498f
Bytes: 19
DecreaseFrameSize()

File: compiler/optimizing/code_generator_x86.cc

493:0-495:35
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 23147232_1c83d951
Bytes: 19
IncreaseFrameSize()

504:0-506:36
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_7da65311
Bytes: 19
DecreaseFrameSize()

File: compiler/optimizing/code_generator_x86_64.cc

504:0-506:35
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_1db51732
Bytes: 19
IncreaseFrameSize()

535:0-537:36
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 63002af0_bec3b5a4
Bytes: 19
DecreaseFrameSize()

File: compiler/utils/arm/assembler_arm.cc

390:25-390:30
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 63002af0_be1f35e2
Bytes: 122
I find at() rather ugly. Just make this a range-based loop:

  for (const ManagerRegister& reg : callee_save_regs) { ... }

442
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 23147232_bce62d58
Bytes: 16
range-based loop

File: compiler/utils/arm64/assembler_arm64.cc

665
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 23147232_fcc385b5
Bytes: 9
constexpr

666:25-666:41
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 23147232_9cca49c6
Bytes: 11
arraysize()

728
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 63002af0_de1201dc
Bytes: 9
constexpr

729:25-729:41
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 43116641_9d1c87ee
Bytes: 11
arraysize()

File: compiler/utils/assembler.h

358:65-358:76
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 63002af0_7ed08d80
Bytes: 10
explicitly

376:0-376:1
Wed Mar 25 15:55:12 2015 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 63002af0_5ed5d16e
Bytes: 20
Bogus space, remove.

