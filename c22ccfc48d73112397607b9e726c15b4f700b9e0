Revision: c22ccfc48d73112397607b9e726c15b4f700b9e0
Patch-set: 1
File: compiler/optimizing/code_generator.cc

329:7-340:83
Mon Nov 09 16:19:26 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: d6345268_a2f77e7d
Bytes: 226
Instead of putting this "hack" here, could we just make those HInstructions generate simpler code with read barriers? And then we could have a follow-up change to have typed temporaries be understood by the register allocator.

329:7-340:83
Mon Nov 09 19:07:59 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: d6345268_a2f77e7d
UUID: d60ff2af_6d12b172
Bytes: 65
Sure, we can address this in a follow-up change.  Removed in PS3.

File: compiler/optimizing/code_generator_x86.cc

559:4-562:37
Fri Nov 06 09:53:46 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: d60ff2af_0a38bba8
Bytes: 171
I realized today that InvokeRuntime always calls RecordPcInfo, and after Tuesday's discussion, I think we probably do not need it.  I'll update this in the next patch set.

559:4-562:37
Mon Nov 09 19:44:00 2015 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: d60ff2af_0a38bba8
UUID: 760646d1_f77c809c
Bytes: 67
Not sure I understand the thing with RecordPcInfo. Can you clarify?

559:4-562:37
Tue Nov 10 11:44:40 2015 +0000
Author: Roland Levillain <1052644@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 760646d1_f77c809c
UUID: db11db43_7ac7796c
Bytes: 730
InvokeRuntime always calls RecordPcInfo, which records the Dex PC, the native PC, stack maps, etc. for this code location.

However, I think we may actually not need to record this information, as that read barrier runtime entry point call shall never fail or be interrupted IIUC (meaning we may never use that information).

In this regard, I thought calling the ReadBarrierSlow or ReadBarrierForRootSlow entry points should be no different than calling the runtime to perform, say, a type conversion (e.g. calling the F2l entry point to perform a float-to-long conversion on x86), as this operation should not fail nor be interrupted, and for which RecordPCInfo is special-cased not to record any information.

I'll investigate.

559:4-562:37
Tue Nov 10 18:49:59 2015 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: db11db43_7ac7796c
UUID: 369daed4_f36be887
Bytes: 53
Thanks for the clarification. Yes, that sounds right.

