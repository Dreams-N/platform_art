Revision: 276eea32f42642747bd253d8643521dbde325c7d
Patch-set: 2
File: runtime/class_linker.cc

3338:6-3339:71
Fri Jun 06 00:27:34 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bf505ca5_929de1e0
Bytes: 41
Combine these two if statements into one?

3339
Fri Jun 06 01:49:20 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bf505ca5_929de1e0
UUID: df4350e0_9ae093ad
Bytes: 4
Done

3356:8-3357:73
Fri Jun 06 00:27:34 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 3f162cdd_443c6bdc
Bytes: 26
Combine the if statements?

3357
Fri Jun 06 01:49:20 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 3f162cdd_443c6bdc
UUID: df2c3030_c37ab595
Bytes: 4
Done

File: runtime/debugger.cc

1606:4-1606:19
Fri Jun 06 00:27:34 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bf505ca5_d2dfe997
Bytes: 117
Should line 1552 be like here and just call m->GetDexFile() without going through GetDeclaringClass()->GetDexCache()?

1606
Fri Jun 06 01:49:20 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bf505ca5_d2dfe997
UUID: 1f1b2808_cf82d33f
Bytes: 51
This way is probably correct actually, I'll fix it.

File: runtime/entrypoints/entrypoint_utils.h

689:52-689:53
Fri Jun 06 00:27:34 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bf505ca5_f2cd45fa
Bytes: 78
This 'm' could have moved due to the GetReturnType() call above? Use a Handle?

689
Fri Jun 06 01:49:20 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bf505ca5_f2cd45fa
UUID: df4350e0_5ada0bf7
Bytes: 11
Nice catch.

File: runtime/entrypoints/quick/quick_trampoline_entrypoints.cc

607:10-607:30
Fri Jun 06 00:27:34 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 3f162cdd_8984de84
Bytes: 249
If we use proxy_method directly for the PrettyMethod (in the same line), then we could use proxy_method directly within the DCHECK as well? And how about swapping lines 606 and 607 to avoid the look of using the method under wrapping it in a handle?

607
Fri Jun 06 01:49:20 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 3f162cdd_8984de84
UUID: 1f1b2808_8f8cdb72
Bytes: 55
Deleted the method helper here, it is no longer needed.

File: runtime/handle.h

105:5-105:11
Fri Jun 06 00:27:34 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bf505ca5_d217e9d6
Bytes: 84
I wonder if there's an easy way to prevent Assign() from being called on NullHandle?

105
Fri Jun 06 01:49:20 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bf505ca5_d217e9d6
UUID: df2c3030_6363a1e6
Bytes: 152
I plan on making it inherit ConstHandle instead of Handle but that requires changing most Handle parameters to be ConstHandles which will be another CL.

File: runtime/interpreter/interpreter_goto_table_impl.cc

361:11-361:15
Fri Jun 06 00:27:34 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bf505ca5_d2c5a91a
Bytes: 28
Is this SetJ call necessary?

361
Fri Jun 06 01:49:20 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bf505ca5_d2c5a91a
UUID: 1f1b2808_2f582f32
Bytes: 98
Not sure, it might be necessary to clear the other 32 bits of JValue? I'll add shertz as reviewer.

361
Fri Jun 06 23:14:09 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 1f1b2808_2f582f32
UUID: df4350e0_a0851e49
Bytes: 194
It seems 'result' is zero-initialized at line 327. MethodExitEvent takes it as a const reference where I don't expect a mutation to it. So, it should still be all zero at this point?

Sebastien?

361
Sat Jun 07 01:29:30 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: df4350e0_a0851e49
UUID: bf505ca5_31a08897
Bytes: 4
Done

361
Mon Jun 09 14:32:47 2014 +0000
Author: Sebastien Hertz <1029223@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bf505ca5_31a08897
UUID: df719054_90f5daed
Bytes: 84
Yeah the "SetJ(0)" is needless: JValue should already be initialized in constructor.

361
Mon Jun 09 17:45:02 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: df719054_90f5daed
UUID: df4350e0_541e5ff8
Bytes: 4
Done

362:4-362:28
Mon Jun 09 14:23:08 2014 +0000
Author: Sebastien Hertz <1029223@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bf7e9c23_2f8cc570
Bytes: 159
Result is used in Instrumentation::MethodExitEvent so the debugger sends the result of the ending method. It should be initialized before calling it (line 352)

362
Mon Jun 09 17:45:02 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bf7e9c23_2f8cc570
UUID: df4350e0_b4f24376
Bytes: 4
Done

File: runtime/interpreter/interpreter_switch_impl.cc

269:15-269:19
Fri Jun 06 00:27:34 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 7f33447f_9216281d
Bytes: 30
Is this SetJ() call necessary?

269
Fri Jun 06 01:49:20 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 7f33447f_9216281d
UUID: df2c3030_03c3cd71
Bytes: 18
See other comment.

269
Mon Jun 09 14:32:47 2014 +0000
Author: Sebastien Hertz <1029223@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: df2c3030_03c3cd71
UUID: df719054_b0fa56db
Bytes: 101
Note: here result is initialized at the right place. The compute goto interpreter should do the same.

269
Mon Jun 09 17:45:02 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: df719054_b0fa56db
UUID: 3f646c99_48eb3f8a
Bytes: 4
Done

File: runtime/mirror/art_method.h

82:7-82:15
Fri Jun 06 00:27:34 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 3f162cdd_89e37ef0
Bytes: 117
Why don't we have to call GetInterfaceMethodIfProxy() here? I guess I don't understand what a proxy method is really.

82
Fri Jun 06 01:49:20 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 3f162cdd_89e37ef0
UUID: df2c3030_23c8498b
Bytes: 125
I think we only need that at call sites where we used to use MethodHelper::IsStatic, I'll try to make sure I didn't miss any.

File: runtime/object_utils.h

227:17-227:30
Fri Jun 06 00:27:34 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bf505ca5_728e15dc
Bytes: 83
If this can cause a GC, which was the bug, how about adding a comment to note that?

227
Sat Jun 07 01:29:30 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bf505ca5_728e15dc
UUID: 1f1b2808_6f6627f8
Bytes: 5
Done.

File: runtime/reflection.cc

372:13-372:14
Fri Jun 06 00:27:34 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bf505ca5_9201616e
Bytes: 126
m could be moved after the GetClassFromTypeIdex() call? Use a handle around m by declaring a handle for m as a local variable?

372
Fri Jun 06 01:49:20 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bf505ca5_9201616e
UUID: df2c3030_a3b4590d
Bytes: 33
I'll use a HandleWrapper for now.

378:26-378:40
Fri Jun 06 00:27:34 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 3f162cdd_0989aea8
Bytes: 106
If this bug refers to the use of m after the GetClasFromTypeIdx() call, then use a Handle to fix this bug?

378
Fri Jun 06 01:49:20 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 3f162cdd_0989aea8
UUID: df2c3030_83b7dd11
Bytes: 174
Its actually related to the args since they could contain StackReferences. This will be hard to fix, I'll need to use a RememberForGC visitor like in the trampolines I think.

378
Fri Jun 06 23:14:09 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: df2c3030_83b7dd11
UUID: df2c3030_06b43abd
Bytes: 26
I see. I guess another CL.

383:45-383:46
Fri Jun 06 00:27:34 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 7f33447f_7227e43d
Bytes: 22
Same comment as above.

383
Fri Jun 06 01:49:20 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 7f33447f_7227e43d
UUID: df2c3030_43c1c560
Bytes: 4
Done

File: runtime/verifier/method_verifier.cc

2145:46-2145:59
Fri Jun 06 00:27:34 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 7f33447f_921e28f6
Bytes: 393
If the above GetReturnType() could invoke a GC, then called_method directory here isn't moving GC-safe? Maybe store the Handle for called_method above in a local variable and use it here, as in,

Handle<mirror::ArtMethod> h_called_method = hs.NewHandle(called_method);
MethodHelper mh(h_called_method);

...

  return_type = &reg_types_.FromClass(h_called_method->GetReturnTypeDescriptor(),

?

2145
Fri Jun 06 01:49:20 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 7f33447f_921e28f6
UUID: df2c3030_03aaeda9
Bytes: 4
Done

3837:45-3837:59
Fri Jun 06 00:27:34 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bf505ca5_928721c0
Bytes: 70
Same comment as above. Wrap mirror_method in a handle and use it here?

3837
Fri Jun 06 01:49:20 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bf505ca5_928721c0
UUID: df2c3030_23afe9b9
Bytes: 4
Done

File: test/ReferenceMap/stack_walk_refmap_jni.cc

61:17-61:19
Fri Jun 06 00:27:34 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 3f162cdd_e9fb1a27
Bytes: 44
Same comment as the one in stack_walk_jni.cc

61
Fri Jun 06 01:49:20 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 3f162cdd_e9fb1a27
UUID: 1f1b2808_af6c3fd9
Bytes: 4
Done

61
Fri Jun 06 23:14:09 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 1f1b2808_af6c3fd9
UUID: 1f1b2808_d24cb8ad
Bytes: 69
Now we can/should remove the unused arg 'mh' from IS_IN_REF_BITMAP().

61
Sat Jun 07 03:43:52 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 1f1b2808_d24cb8ad
UUID: 7f33447f_1b9310d6
Bytes: 69
Can you remove the unused first parameter 'mh' of IS_IN_REF_BITMAP()?

File: test/StackWalk/stack_walk_jni.cc

63:17-63:19
Fri Jun 06 00:27:34 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bf505ca5_32464de0
Bytes: 263
Maybe this MethodHelper isn't necessary?

It's used in macro REG (through CHECK_REGS), but we just call GetMethod() to extract the method out of the MethodHelper there.

Do we still need a Handle independent of MethodHelper if GC can happen in the following code?

63
Fri Jun 06 01:49:20 2014 +0000
Author: Mathieu Chartier <1015378@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: bf505ca5_32464de0
UUID: 1f1b2808_cf6973c9
Bytes: 4
Done

63
Fri Jun 06 23:14:09 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 1f1b2808_cf6973c9
UUID: 1f1b2808_72592c68
Bytes: 38
We can remove the 'mh' arg from REG().

63
Sat Jun 07 03:43:52 2014 +0000
Author: Hiroshi Yamauchi <1022530@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 1f1b2808_72592c68
UUID: ff749443_94c86cec
Bytes: 56
Can you remove the unused first parameter 'mh' of REG()?

