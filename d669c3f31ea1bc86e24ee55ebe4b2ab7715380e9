Revision: d669c3f31ea1bc86e24ee55ebe4b2ab7715380e9
Patch-set: 2
File: compiler/oat_writer.cc

1195:52-1196:38
Wed Aug 10 14:20:43 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 79af3bf6_52d4740f
Bytes: 64
I think this should be GetDexCache(patch.TargetStringDexFile());

1195:52-1196:38
Wed Aug 10 17:51:02 2016 +0000
Author: Christina Wadsworth <1109993@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 79af3bf6_52d4740f
UUID: b927f349_11cebb87
Bytes: 24
Yes, I will change this.

File: runtime/class_linker.cc

1275:35-1275:77
Wed Aug 10 14:20:43 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 59dd179f_692a6584
Bytes: 78
std::min(dex_file->NumStringIds(), mirror::DexCache::kDexCacheStringCacheSize)

1275:35-1275:77
Wed Aug 10 17:51:02 2016 +0000
Author: Christina Wadsworth <1109993@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 59dd179f_692a6584
UUID: b927f349_b12b479a
Bytes: 206
All dex caches need to be of size 1024 because of assumptions other places in the code. There isn't a lot of space lost doing this, and we still have 95% savings total compared to previous string dex cache.

1275:35-1275:77
Thu Aug 11 18:34:16 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: b927f349_b12b479a
UUID: fefcf12c_1ee3cd2c
Bytes: 219
Where do we make such assumptions? I'd expect everything to be fine if we use the min() because for

    index < dex_file->NumStringIds()

we would access entry at

    index % 1024 < min(1024, dex_file->NumStringIds())

File: runtime/utils/dex_cache_arrays_layout-inl.h

96:19-96:61
Wed Aug 10 14:20:43 2016 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: b9a8d3f4_acb3c3b2
Bytes: 135
std::min(dex_file->NumStringIds(), mirror::DexCache::kDexCacheStringCacheSize), there is no reason to waste memory for small dex files.

