Revision: e10d4d48f4764efb3cb4b50a968d3fb6c2d08e9a
Patch-set: 2
File: compiler/dex/mir_optimization.cc

992
Wed Mar 12 12:07:53 2014 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: bcb4e5de_9da947a7
Bytes: 144
Should all this code actually go to Gate()? It's a bit of a hack to use temp_bit_vector_size_==0 as an indication to skip the WalkBasicBlocks().

996
Wed Mar 12 12:07:53 2014 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: dce519f4_a1c25a72
Bytes: 183
After any successful iget/iput/invoke, the class is surely initialized. But is it safe to assume that the type is in the dex cache? Or should I limit this just to invoke-static/range?

996
Thu Mar 13 02:08:11 2014 +0000
Author: Ian Rogers <1010118@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: dce519f4_a1c25a72
UUID: 9cb9e1da_692c9a7a
Bytes: 58
What happens if there's an exception in initializer error?

996
Thu Mar 13 10:58:50 2014 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 9cb9e1da_692c9a7a
UUID: 3c1ab5b4_7a2e2111
Bytes: 111
If any exception is thrown (NPE or clinit error), we won't reach those insns where we're eliminating the check.

996
Thu Mar 13 16:17:40 2014 +0000
Author: Ian Rogers <1010118@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 3c1ab5b4_7a2e2111
UUID: fce81dcd_e9b510f8
Bytes: 287
Ok. How is the case:

class MyOtherClass {
  static {
    throw new Exception("boo");
  }
  static int x;
}
class MyClass {

static {
  try {
    MyOtherClass.x = 100;  // Should fail with EIIE
  } catch(Throwable ignored) {
  }
  MyOtherClass.x = 100;  // Should fail again.
}

handled?

996
Thu Mar 13 16:22:46 2014 +0000
Author: Vladimir Marko <1018108@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: fce81dcd_e9b510f8
UUID: dce519f4_6fb03908
Bytes: 290
There is a catch handler, isn't there? In EliminateClassInitChecks(), the BasicBlock for the catch handler will go through the SetInitialBits() branch and the BasicBlock for the assignment will go through the Union() branch, so it will have the bit set and the check will not be eliminated.

