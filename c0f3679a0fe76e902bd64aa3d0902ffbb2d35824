Revision: c0f3679a0fe76e902bd64aa3d0902ffbb2d35824
Patch-set: 11
File: compiler/optimizing/code_generator_x86.cc

40:0-40:65
Wed Mar 04 16:39:25 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 12da56a9_e9ef7583
Bytes: 49
Please make the callee-save change a separate CL.

40:0-40:65
Wed Mar 04 17:16:47 2015 +0000
Author: Mark P Mendell <1036869@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 12da56a9_e9ef7583
UUID: 92c566cf_e5df9651
Bytes: 264
Unfortunately, if I don't change the callee-save registers, I get a failure during register allocation.  If one of the inputs to a long Mul is the result of a long Div, the result is in EAX:EDX, and that uses up both register pairs available (EAX:ECX and EDX:EBX).

40:0-40:65
Wed Mar 04 18:27:39 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 92c566cf_e5df9651
UUID: 12da56a9_89a7d90c
Bytes: 81
Sure. But you should build the regalloc change on top of the callee-save changes.

40:0-40:65
Wed Mar 04 20:55:04 2015 +0000
Author: Mark P Mendell <1036869@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 12da56a9_89a7d90c
UUID: 9273a693_15d3d455
Bytes: 4
Done

1455
Tue Mar 03 20:55:17 2015 +0000
Author: Mark P Mendell <1036869@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 7251d2a7_3c7631d6
Bytes: 139
Any clues on why this doesn't work would be appreciated.  My best guess is that it is due to EAX:EDX being a non-even/even+1 register pair.

File: compiler/optimizing/nodes.cc

999:0-999:95
Wed Mar 04 15:54:01 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 929c86d9_4dbe9917
Bytes: 127
What happens, when you have FP->DS, DS->DS, DS->FP ? Looks to me that you're going to split the second move, but this is wrong.

999:0-999:95
Wed Mar 04 16:07:28 2015 +0000
Author: Mark P Mendell <1036869@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 929c86d9_4dbe9917
UUID: d2d35e94_07d0f645
Bytes: 247
Yes, that seems wrong to me. Unfortunately, we want to split it if you replace FP with RP. BTW, is FP 'float pair', or 'XMM reg'?

Do you suggest moving the splitting to the ParallelMoveResolver, where we can scan to see if we have register pairs?

999:0-999:95
Wed Mar 04 16:09:32 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: d2d35e94_07d0f645
UUID: 12da56a9_8997d91a
Bytes: 116
In the context of x86, FP can only be XMM reg. Maybe the splitting should be done in the register allocator instead.

999:0-999:95
Wed Mar 04 16:53:37 2015 +0000
Author: Mark P Mendell <1036869@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 12da56a9_8997d91a
UUID: d2d35e94_0753d63c
Bytes: 198
Thinking about this, splitting a DS->DS should be okay.  The actual code used will split it anyways, because we are using a core register to copy.  I think the 'Contains' code should get this right.

File: compiler/optimizing/register_allocator.cc

106:0-108:50
Wed Mar 04 15:54:01 2015 +0000
Author: Nicolas Geoffray <1038443@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 929c86d9_2db7cd3d
Bytes: 57
How can you state things pass with those checks disabled?

106:0-108:50
Wed Mar 04 16:07:28 2015 +0000
Author: Mark P Mendell <1036869@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 929c86d9_2db7cd3d
UUID: d2d35e94_47daee67
Bytes: 109
Forgot to restore this...  will do so, and try again.  They were disabled earlier in the development process.

1475
Wed Mar 04 23:04:07 2015 +0000
Author: Mingyao Yang <1043514@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 7220f282_a45f424b
Bytes: 185
During gc time, it's possible both the spill slot and the register need to be relocated. So we need to do SetRegisterBit() as long as it's a reference. What's the issue you were seeing?

